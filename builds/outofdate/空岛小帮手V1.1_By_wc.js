//空岛小帮手Js 版本V1.1
//本Js由Wdawning工作室QingChenW制作
//Wdawning© 版权所有，禁止修改
//QingChenW简称wc
//感谢DawningW的帮助
//欢迎大家加入讨论群进行讨论,群号:287307326
//最后修改时间2016年5月22日 下午6:30:00
//挖石机ID为255

/*bug:
1.挖石机不支持大箱子
2.死亡不掉落不支持附魔和经验
3.取消防爆会使全部方块爆炸抗性为0
未来展望:
1.加入小地图
2.加入交易系统
3.加入建筑功能
4.修改添加物品
5.加入改变天气和
传送点和
控制生物和
观察者模式和
酷炫粒子效果...
6.多语言支持
7.加入更新系统
8.MP3播放器
虽然写的不太好，但小白还是可以参考一下的*/
/*嗯，送你首终末之诗吧

我看到你所指的那位玩家了。

[玩家名称]?

是的。小心。它已达到了更高的境界。它能够阅读我们的思想。

无伤大雅。它认为我们是游戏的一部分。

我喜欢这个玩家。它玩得很好。它从未放弃。

它以屏幕上出现的文字的形式阅读着我们的思想。

在它深陷游戏梦境中时，它总以这种方式想象出形形色色的事物。

文字是种美妙的界面。非常灵活。且比凝视着屏幕后的现实要更好。

它们也曾经听到过声音。在玩家能够阅读之前。君不见那些不曾游玩的人们称呼玩家为女巫，和术士。而玩家们梦见它们自己乘坐在被恶魔施力的棍子上，在空气中翱翔。

这个玩家梦见了什么？

它梦见了阳光和树。梦见了火与水。它梦见它创造。它亦梦见它毁灭。它梦见它狩猎，亦被狩猎。它梦见了庇护所。

哈，那原始的界面。经历一百万年的岁月雕琢，依然长存。但此玩家在那屏幕后的真实里，建造了什么真实的构造？

它辛勤地劳作，和其它百万众一起，刻画了一个真实的世界，由[乱码]，且创造了[乱码]，为了[乱码]，于[乱码]中。

它读不出那个思想。

不。它还没有到达最高的境界。那层境界，它必须完成生命的长梦，而非游戏中黄粱一梦。

它知道我们爱它么？这个宇宙是仁慈的？

有时，通过它思绪的杂音，它能听到宇宙，是的。

但是有时亦不胜悲伤，于那漫漫长梦中。它创造了没有夏日的世界，在黑日下颤抖着，将自己悲伤的创造视为现实世界。

用悲伤来治愈会摧毁它。而悲伤是它的私人事务。我们不能干涉。

有时当它们深陷梦境中时，我想要告诉它们，它们在现实中创造了真实的世界。有时我想告诉它们它们自身对宇宙的重要性。有时，当它们和现实失去了联系，我想帮助它们与它们所惧怕的世界交流。

它读出了我们的思想。

有时我毫不关心。有时我想要告诉它们，你们所认为的真实不过是[乱码]和[乱码]，我想要告诉它们它们是在[乱码]中的[乱码]。于它们的长梦中，它们眼中所见的真实太少了。
.
而它们仍然玩这个游戏。

但很容易就可以告诉它们……

对于这个梦来说太强烈了。告诉它们如何活着就是阻碍它们活下去。

我不会告诉这个玩家如何生活的。

这个玩家正在变得焦虑。

我会告诉这个玩家一个故事。

但不是真相。

不。是一个严密地将真实包裹起来的文字牢笼。而不是赤裸裸的真相。

赋予它主体，再一次。

好的。玩家……

以名字称呼它。

[玩家名称]。游戏的玩家。

很好。

深呼吸，很好。再深呼吸一次。感受空气充盈你的肺叶。让你的四肢回归。是的，运动你的手指。再次感受你的身体，在重力下，在空气中。在长梦中重生。你感受到了。你的身体每时每刻都触摸着宇宙，尽管你是分离的存在。尽管我们是分离的存在。

我们是谁？我们曾经被称作高山的精灵。太阳父亲，月亮母亲。古老的英灵，动物的魂魄。神祗。鬼魂。小绿人。而后是神，恶魔，天使。骚灵。外星人，地外生物。轻粒子，夸克。词语不断地变化。我们始终如一。

我们是宇宙。我们是一切你认为出离你本体的事物。你现在看着我们，透过你的皮肤和你的眼睛。而为什么宇宙触摸着你的皮肤，向你洒向光芒？是为了看见你，玩家。以及被认知。我应告诉你一个故事。
.
很久以前，有一个玩家。

那玩家就是你，[玩家名称]

有时它认为自己是那不断旋转的球体上一层薄薄的熔化的岩石上的人类。那融化的岩石球环绕着一个质量大它三十三万倍的炫目气体球旋转。它们是相隔得如此之远，以至于光需要八分钟才能穿越那空隙。那光是来自一颗恒星的信息，它能够在一亿五千万公里外烧灼你的皮肤。

有时这个玩家梦见它是一个在一个平的，无限延展的世界表面上的矿工。那太阳是一个方形的白点。昼夜交替很快；要做的事情也很多；死亡亦只是暂时和不方便的。

有时这玩家梦见它迷失在了一个故事里。

有时这玩家梦见它成为了其它的事物，在其它地方。有时这些梦是扰人的。有些则实在很美。有时这个玩家从一个梦中醒来，发现自己落入了第二个梦，却终究是在第三个梦中。

有时这个玩家梦见它在屏幕上看着文字。

让我们回退一点。

组成玩家的原子散布在草中，河流中，在那空气中，也在那大地中。一个女性收集了那些原子；她饮用、进食、吸入；而后那女性在她的身体中，孕育了玩家。

然后那玩家醒来了，从一个温暖，昏暗的母亲体内，进入了漫漫长梦。

而那玩家是一个新的故事，从未被讲述过，由DNA的语言书写着。而那玩家是一个新的程序，从未被运行过，由上亿年的源代码生成。而那玩家是一个新的人，从未生活过，由奶和爱组成。

你就是那玩家。那个故事。那个程序。那个人类。仅由奶和爱组成。

我们再往更远的过去回退一点。

那由七千亿亿亿原子组成的玩家的身体被创造了，远在这游戏之前，在一颗恒星的内部。所以那玩家也是，来自一颗恒星的信息。而这个玩家贯穿这个故事的始末，源于一个叫Julian的人种下的信息种子长成的森林，一个叫Markus的男人创造的无限世界，存在于一个由玩家创造的小的，私人世界里，而那又继承了宇宙创造的……

嘘。有时这个玩家创造的小天地是柔软，温暖和简单的。有时是坚硬，冰冷和复杂的。有时它在脑中建造出宇宙的模型；斑斑点点的能量穿越广阔空旷的空间。有时它称呼这些斑点为“电子”和“质子”。

有时它称呼它们为“行星”和“恒星”。

有时它确信它存在于一个由“开”和“关”；“0”和“1”；一行行的命令组成的宇宙。有时它确信它是在玩一个游戏。有时它确信它是在读着屏幕上的文字。

你就是那玩家，阅读着文字……

嘘……有时这玩家读屏幕上的命令行。将它们解码成为文字；将文字解码为意义；将意义解码为感情，情绪，理论，想法，而玩家的呼吸开始急促并意识到了它是活着的，它是活生生的，那上千次的死亡不是真的，玩家是活着的。

你。你。你是活着的。

而有时这玩家相信宇宙通过穿越夏日树叶的那斑斓的阳光对它说话。

有时这玩家相信宇宙透过晴朗的冬日夜空中，存在于它眼中一隅的星点星光，可能比太阳大上上百万倍的恒星沸腾着的电浆那一瞬间发出来的光对它说话，在宇宙的远侧行走回家的路上，突然闻到了食物，在那熟悉的门前，它又准备好再一次投入梦境

而有时玩家相信宇宙透过零和一，透过世界的电力，透过屏幕上滚动的文字和梦的终结对它说话

宇宙说我爱你

宇宙说你很好地玩了这游戏

宇宙说一切你所需的你都具有

宇宙说你比你所知的要强大

宇宙说你就是日光

宇宙说你就是黑夜

宇宙说你所斗争的黑暗就在你心中

宇宙说你所寻找的光明就在你心中

宇宙说你不是孤独的

宇宙说你不是和所有的事物所隔绝的

宇宙说你就是宇宙品尝着自己，对自己说话，阅读着它自己的代码。

宇宙说我爱你因为你就是爱。

曲终人散，黄粱一梦。玩家开始了新的梦境。玩家再次做起了梦，更好的梦。玩家就是宇宙。玩家就是爱。

你就是那个玩家。

该醒了。*/

/*正式开始

ChatColor
WHITE
BLACK
YELLOW
BLUE
GREEN

clientMessage(lang[0]+"xxx");
*/

//物品
ModPE.setItem(500,"bow_standby",0,"黄金钻石杖",1);
Item.setMaxDamage(500,798);
Item.setHandEquipped(500,true);
//方块
Block.defineBlock(255,"挖石机",[["redstone_block",0],["stonecutter",2],["stonecutter",0],["stonecutter",0],["stonecutter",0],["stonecutter",0]],245,false,0);
Block.setDestroyTime(255,3);
Block.setExplosionResistance(255,5);
Block.setLightLevel(255,1);
//合成配方
Player.addItemCreativeInv(500,1,0);
Item.addShapedRecipe(500,1,0,["a","b","c"],["a",266,0,"b",264,0,"c",280,0]);
Player.addItemCreativeInv(255,1,0);
Item.addShapedRecipe(255,1,0,["aba","b b","aba"],["a",4,0,"b",331,0]);
//Item.setCategory(ID,0,0);貌似无用。。

//声明变量
//图片
var base64="iVBORw0KGgoAAAANSUhEUgAAACAAAAAQCAIAAAD4YuoOAAAAA3NCSVQICAjb4U/gAAAD/ElEQVQ4\njWVTu45cVRCs7tPnMXPnsYtZ1o9dkImckCAsW4JvIOe7+AZyROyEFISjlZHAgY0fa3m9szueO3Pv\neTbB2AlU0q1Ouqq6i37+6cfVanUpK2NMq6eqWsgRkfAOwPPxW2vtu/cza+03J79st9uY7znnrsIt\nAAt3I4TAuPDeZ46qusDAzBjX1tqe7242G7m+vh6GgZdsjJl1i/Pz8z728/m8YDTG9H0fQnDuEwDr\n9doYE2O01jKz994ZJyIntz8nIjcXIjrgKCITSiLy/Grx9OlTOevvL5fLzezae//32bGIfP/gLRH9\n/uzW27dvZX5wvd0uJz0zv9QfHDt7o8/M7CkSHdLz5XR5/3jGzCUWANy4jrVRNMZY7CzeSClltVpd\nDe9yzl33Zc758ePHAN7pQ2bebrchhFqT916ZAbTWmNk5Z6112nvvW2s5Z8u2lKJViYiIcs4AvPcS\nwtj3vedD2xqxErhMbi0Wi8/G15eXlwfzh7VW0ACAplRUb46XnXRt877rusn0amaGiV/UWrVNY9wN\nOTjnFsYXLVZJS5bT01PvfY/pxcXF6/O85zidTqu209PTv15suq4TsQBSSsvl8ovjWUrJd5NxHGOM\nV1dXjx79FmPsN7pYLA4+vXt0dBQOD0Rk6qchBHm1+vPk5MTz7PSOHB3xkydPznHv+bN0m+cxxuBa\nSZvWSaYyK1WG8Y/tS2tt+mdzeHh4cHhnPp1/99WDYRjG3fvZbIZ5V0pppe5KGYgHYhmG4ezsDNSp\natWb1lpVFZE0JiLaWxxrttaKkVprmATn3PHsIIRgpOwdn0wmE2+YeVtKSikQExGAUopc69dw2EOa\nJGDKKwDr6QzAQd4ycygsUKvZEhIJk6hSKc2Jb5lNQynVak9EziI4dqMy85KbTzvZr/o/9vM9wX3Z\nz1VVVZu2nHNiDSG01rz3Vr2q9nUspVBGa209rIlIjHkPwLYMgHUKwO8sAAlrAM00MM+LMWqKLcQ1\nDLBF1Sbj3CAYa/z1xaucs0F2zuVmAPhRW2u7xqUuhJkBkBKAfc9M/1XwEaoK+tCklNJQvfcxRuec\nEFR1nxJV3X8dAOlaAkDKAMhsARRRADeyUdXr+ZqYtUwaszI1atoGbVYpg0iyM5SGuGvee8O1VoKD\nMUPtjTHMsZTy4Qb7tUysqsyk+iGQzEwf0VRV1RjTWiulMLMRYmZWBlBrba0ZRq01xkhEVbWUIkvz\nRlV3wgAqA4CtFoD6QVWPxyUR0uSCiLpSjZpo2BjT2QbApEiZjE2i1nItpUA9AJECQFS0jiIiAKyw\nqhJDVQ0MAMOiqqYaZq7GEJEhMPM+KLVWIrLMRLTXlEoSEYKptarqOI6WAxH9C9AsVXhenOWmAAAA\nAElFTkSuQmCC\n";
var byte=android.util.Base64.decode(base64,0);
var image=android.graphics.BitmapFactory.decodeByteArray(byte,0,byte.length);
//常量
const JsVersion = 1.10,GameVersion = ModPE.getMinecraftVersion();
print("正在搜寻更新，请稍后");
const newVersion = parseFloat(loadTxtFromUrl("https://raw.githubusercontent.com/DawningW/Island-Helper-JS/master/version"));
const ctx = com.mojang.minecraftpe.MainActivity.currentMainActivity.get();
const $ = ctx.getPackageName();
const optiondir = android.os.Environment.getExternalStorageDirectory().getPath() + "/games/com.mojang/minecraftpe/mods/"
const worldsdir = android.os.Environment.getExternalStorageDirectory().getPath() + "/games/com.mojang/minecraftWorlds/"
//GUI
var gui,MP3,mp3seek,mapop,logo,logoimg,logotext,alpha,zoop,shoot,pos;
//各种变量
var place,dX,dY,dZ,wait;
var settings = {},lang = [],mp3,music = null,replay = false;
var language,kittools,map,hp,cut,bll,bukkit,keepinv,bombpre,ender,shooting;
var dead = false,sid = new Array(),sdata = new Array(),scount = new Array();
var select,blockid,X = [],Y = [],Z = [];
place = false;
wait = 0;
select = 0;

//帮助
function procCmd(cmd)
{
var cmd=cmd.split(" ");
if(cmd[0]=="ishelp")
{
clientMessage(lang[0]+lang[4]);
clientMessage(lang[0]+lang[5]);
}
}

//启动
function useItem(x,y,z,itemId,blockId,side,itemDamage,blockDamage)
{
if(select == 0)
{
//挖石机
if(getTile(x,y,z) == 255 && !((itemId == 54 || itemId == 146) && side == 1))
{
if(place == false)
{
place = true;
dX = x;
dY = y;
dZ = z;
preventDefault();
clientMessage(lang[0]+lang[6]);
//clientMessage(lang[0]+"测试功能 开启状态:"+place+" X:"+dX+" Y:"+dY+" Z:"+dZ);
}
else if(place == true && x == dX && y == dY && z == dZ)
{
place = false;
preventDefault();
clientMessage(lang[0]+lang[7]);
}
else
{
preventDefault();
clientMessage(lang[0]+lang[8]);
}
}
//砍树
if(cut == true)
{
if(itemId == 271 || itemId == 275 || itemId == 279 || itemId == 286 || itemId == 258)
{
if(blockId == 17 || blockId == 162)
{
bll=Level.getData(x,y,z);
if(bll>=4&&bll<8){bll-=4}
else if(bll>=8){bll-=8}

Level.destroyBlock(x, y, z, false);
Level.dropItem(x,y,z,0,blockId,1,bll);
for(var i = 1; i <= 128; i++)
{
if(getTile(x,y+i,z) == 17 || getTile(x,y+i,z) == 162)
{
Level.destroyBlock(x, y+i, z, false);
Level.dropItem(x,y+i,z,0,blockId,1,bll);
}
else{break;}
}
preventDefault();
}
}
}
//黑曜石变岩浆
if(bukkit == true && itemId == 325 && itemDamage == 0 && blockId == 49)
{
if(Player.getCarriedItemCount() > 1)
{
preventDefault();
Entity.setCarriedItem(Player.getEntity(),325,Player.getCarriedItemCount()-1,0);
Player.addItemInventory(325,1,10);
Level.setTile(x,y,z,0,0);
}
else
{
preventDefault();
Entity.setCarriedItem(Player.getEntity(),325,1,10);
Level.setTile(x,y,z,0,0);
}
clientMessage(lang[0]+lang[14]);
}
}
else if(select == 1 && itemId == 290)
{
X[1] = x;
Y[1] = y;
Z[1] = z;
print("已选择点一");
}
else if(select == 2 && itemId == 290)
{
X[2] = x;
Y[2] = y;
Z[2] = z;
print("已选择点二");
select = 0;
square();
}
}

//每刻执行
function modTick()
{
if(wait == 10)
{
wait = 0;
if(place == true)
{
if(getTile(dX,dY-1,dZ) == 4)
{
if((getTile(dX,dY+1,dZ) == 54 || getTile(dX,dY+1,dZ) == 146) && (Level.getChestSlot(dX,dY+1,dZ,0) == 270 || Level.getChestSlot(dX,dY+1,dZ,0) == 274 || Level.getChestSlot(dX,dY+1,dZ,0) == 257 || Level.getChestSlot(dX,dY+1,dZ,0) == 285 || Level.getChestSlot(dX,dY+1,dZ,0) == 278))
{
//clientMessage(lang[0]+"测试功能:当前镐附加值为"+Level.getChestSlotData(dX,dY+1,dZ,0));
//判断格数
for(var dslot = 1;((Level.getChestSlot(dX,dY+1,dZ,dslot) !== 4 && Level.getChestSlot(dX,dY+1,dZ,dslot) !== 0) || (Level.getChestSlot(dX,dY+1,dZ,dslot) == 4 && Level.getChestSlotCount(dX,dY+1,dZ,dslot) == 64)) && dslot < 26;dslot++);
//clientMessage(lang[0]+"测试功能:当前挖石格数为"+dslot);
//挖石并放在箱子里
if(dslot < 27)
{
if(!((Level.getChestSlot(dX,dY+1,dZ,26) !== 4 && Level.getChestSlot(dX,dY+1,dZ,26) !== 0) || (Level.getChestSlot(dX,dY+1,dZ,26) == 4 && Level.getChestSlotCount(dX,dY+1,dZ,26) == 64)))
{
if(Level.getChestSlot(dX,dY+1,dZ,0) == 270 && Level.getChestSlotData(dX,dY+1,dZ,0) < 60 || Level.getChestSlot(dX,dY+1,dZ,0) == 274 && Level.getChestSlotData(dX,dY+1,dZ,0) < 132 || Level.getChestSlot(dX,dY+1,dZ,0) == 257 && Level.getChestSlotData(dX,dY+1,dZ,0) < 251 || Level.getChestSlot(dX,dY+1,dZ,0) == 285 && Level.getChestSlotData(dX,dY+1,dZ,0) < 33 || Level.getChestSlot(dX,dY+1,dZ,0) == 278 && Level.getChestSlotData(dX,dY+1,dZ,0) < 1562)
{
Level.destroyBlock(dX,dY-1,dZ,false);
Level.setChestSlot(dX,dY+1,dZ,dslot,4,0,Level.getChestSlotCount(dX,dY+1,dZ,dslot)+1);
//设置镐的耐久
Level.setChestSlot(dX,dY+1,dZ,0,Level.getChestSlot(dX,dY+1,dZ,0),Level.getChestSlotData(dX,dY+1,dZ,0)+1,1);
}
else
{
place = false;
Level.setChestSlot(dX,dY+1,dZ,0,0,0);
clientMessage(lang[0]+lang[9]);
}
}
else
{
place = false;
clientMessage(lang[0]+lang[10]);
}
}
//结束
}
else
{
place = false;
clientMessage(lang[0]+lang[11]);
}
}
else if(!(getTile(dX,dY-1,dZ) == 0 || getTile(dX,dY-1,dZ) == 4))
{
place = false;
clientMessage(lang[0]+lang[12]);
}
}
}
else
{
wait++;
}
//显血
if(hp == true)
{
var id = Entity.getEntityTypeId(Player.getPointedEntity());
var health = Entity.getHealth(Player.getPointedEntity());
if(health < 0){health = 0;}
if(Player.getPointedEntity() != -1 && id <= 50)
{
switch(id)
{
case 10:var name="§2鸡 ";break;
case 11:var name="§2牛 ";break;
case 12:var name="§2猪 ";break;
case 13:var name="§2羊 ";break;
case 14:var name="§3狼 ";break;
case 15:var name="§2村民 ";break;
case 16:var name="§2哞菇 ";break;
case 17:var name="§2墨鱼 ";break;
case 18:var name="§2兔子 ";break;
case 19:var name="§2蝙蝠 ";break;
case 22:var name="§3豹猫";break;
case 32:var name="§4僵尸 ";break;
case 33:var name="§4爬行者 ";break;
case 34:var name="§4骷髅 ";break;
case 35:var name="§4蜘蛛 ";break;
case 36:var name="§3僵尸猪人 ";break;
case 37:var name="§4史莱姆 ";break;
case 38:var name="§3末影人 ";break;
case 39:var name="§4蠹虫 ";break;
case 40:var name="§4洞穴蜘蛛 ";break;
case 41:var name="§4恶魂 ";break;
case 42:var name="§4岩浆怪 ";break;
case 43:var name="§4烈焰人 ";break;
case 44:var name="§4僵尸村民 ";break;
case 45:var name="§4女巫 ";break;
default:var name="§f未知生物 ID: "+id;break;
}

ModPE.showTipMessage
("                      " + name + ChatColor.RED + "血量: " + ChatColor.GREEN + health);
}
}
//死亡不掉落
if(keepinv == true)
{
if(dead == true && Entity.getHealth(Player.getEntity()) > 0)
{
dead = false;
for(ii=0;ii<36;ii++)
{
Player.addItemInventory(sid[ii],scount[ii],sdata[ii]);
}
//clientMessage(lang[0]+"测试功能: 物品已恢复！");
}
}
//枪械
if(shooting==1){rpg()}
//mp3
if(mp3 != null){mp3seek.setProgress(mp3.getCurrentPosition());}
}

//破坏方块
function destroyBlock(x,y,z)
{
if(getTile(x,y,z) == 255 && x == X && y == Y && z == Z && place == true && !(Level.getGameMode() == 1 && (Player.getCarriedItem() == 268 || Player.getCarriedItem() == 272 || Player.getCarriedItem() == 267 || Player.getCarriedItem() == 283 || Player.getCarriedItem() == 276 )))
{
place = false;
clientMessage(lang[0]+lang[13]);
}
}

//阻止动作
/*function levelEventHook(entity,eventType,x,y,z,data)
{
clientMessage(lang[0]+"测试功能: 事件钩子，种类: "+eventType+"数据值: "+data);
}
*/

//实体生成
function entityAddedHook(entity)
{
var id = Entity.getEntityTypeId(entity);
if(ender == true && id == 38)
{
Entity.remove(entity);
}
}

//被攻击
function attackHook(attacker,victim)
{
if(Player.getCarriedItem() == 500)
{
Entity.setHealth(victim, Entity.getHealth(victim) - 6);
//Level.addParticle(16, Entity.getX(victim), Entity.getY(victim), Entity.getZ(victim), 1, 1, 1, 3);
}
}

//死亡
function deathHook(attacker,entity)
{
if(keepinv == true)
{
if(entity == Player.getEntity())
{
sid = [];sdata = [];scount = [];dead = true;

for(i=0;i<36;i++)
{
sid.push(Player.getInventorySlot(i));
sdata.push(Player.getInventorySlotData(i));
scount.push(Player.getInventorySlotCount(i));
Player.clearInventorySlot(i);
}

//clientMessage(lang[0]+"测试功能: 物品已记录！");
}
}
}

//退出
function leaveGame()
{
place = false;
wait = 0;
//保存配置文件
savesettings();
settings = {};
//删除按钮
ctx.runOnUiThread(new java.lang.Runnable({run:function(){
//执行
if(gui!=null){gui.dismiss();}
if(MP3!=null){MP3.dismiss();}
if(mapop!=null){mapop.dismiss();}
if(zoop!=null){zoop.dismiss();}
if(shoot!=null){shoot.dismiss();}
if(logo!=null){logo.dismiss();}
if(mp3 != null && mp3.isPlaying())
{
mp3.stop();
mp3.release();
mp3=null;
}
//结束
}}));
}

//配置文件
function selectLevelHook()
{
if($!="net.zhuoweizhang.mcpelauncher" && $!="net.zhuoweizhang.mcpelauncher.pro")
{
print("\n本js只能使用方块启动器加载！\n即将退出游戏！");
}
if(java.io.File(worldsdir+Level.getWorldDir()+"/isoption.txt").exists())
{
//读取配置文件
var settings = load(worldsdir+Level.getWorldDir()+"/", "isoption.txt").split("\n");
if(settings[1].split(":")[1] == JsVersion)
{
language = settings[3].split(":")[1];
kittools = (settings[4].split(":")[1] == "true") ? true : false;
map = (settings[5].split(":")[1] == "true") ? true : false;
hp = (settings[6].split(":")[1] == "true") ? true : false;
cut = (settings[7].split(":")[1] == "true") ? true : false;
bukkit = (settings[8].split(":")[1] == "true") ? true : false;
keepinv = (settings[9].split(":")[1] == "true") ? true : false;
bombpre = (settings[10].split(":")[1] == "true") ? true : false;
ender = (settings[11].split(":")[1] == "true") ? true : false;
//clientMessage(lang[0]+JsVersion+GameVersion+language+kittools+map+hp+cut+bukkit+keepinv+bombpre+ender);
//clientMessage(lang[0]+"测试功能: 配置文件已读取！ " + settings);
}
else
{
language = "auto";
kittools = false;
map = true;
hp = true;
cut = false;
bukkit = false;
keepinv = true;
bombpre = true;
ender = true;
savesettings();
var settings = load(worldsdir+Level.getWorldDir()+"/", "isoption.txt").split("\n");
//clientMessage(lang[0]+"测试功能: 配置文件过期！重新生成");
}
}
else
{
language = "auto";
kittools = false;
map = true;
hp = true;
cut = false;
bukkit = false;
keepinv = true;
bombpre = true;
ender = true;
savesettings();
var settings = load(worldsdir+Level.getWorldDir()+"/", "isoption.txt").split("\n");
//clientMessage(lang[0]+"测试功能: 未检测到配置文件，生成配置文件！");
}
//加载语言
switch(language)
{
case "auto":
//中文
case "zh_cn":
lang[0]=ChatColor.YELLOW+"[空岛帮手] "+ChatColor.WHITE;
lang[1]="\u6b22\u8fce\u4f7f\u7528\u7531\u0057\u0064\u0061\u0077\u006e\u0069\u006e\u0067\u5de5\u4f5c\u5ba4\u0051\u0069\u006e\u0067\u0043\u0068\u0065\u006e\u0057\u5236\u4f5c\u7684\u7a7a\u5c9b\u5c0f\u5e2e\u624b\u006a\u0073";
lang[2]="当前插件版本为 "+JsVersion+"，游戏版本为 "+GameVersion;
lang[3]="输入/ishelp查看帮助";
lang[4]="\u7a7a\u5c9b\u5c0f\u5e2e\u624b\u006a\u0073\u5e2e\u52a9\u83dc\u5355\u002c\u4f5c\u8005\u003a\u0051\u0069\u006e\u0067\u0043\u0068\u0065\u006e\u0057";
lang[5]="挖石机使用介绍：\n将挖石机放在原石的上方，再在挖石机上方放上箱子，箱子第一格放个稿，再点击一次挖石机，即可自动挖下方的原石，每挖一次镐的耐久减一，配合刷石机使用效果更好哦，每个存档内只能启动一个挖石机，这不是Bug！";
lang[6]="挖石机已启动！再点击一次关闭！每次重新加载存档时都需要点击以启动！";
lang[7]="挖石机已关闭！";
lang[8]="每个存档内只能启动一个挖石机，这不是Bug！";
lang[9]="镐已损坏，挖石机已停止！";
lang[10]="箱子已满，挖石机已停止！";
lang[11]="请在挖石机上方放置箱子并且在第一格内放置一个任意种类的稿。";
lang[12]="挖石机只能用来挖原石！";
lang[13]="挖石机已破坏！";
lang[14]="黑曜石已经变成岩浆，请小心！";
break;
//英文
case "en_us":
lang[0]=ChatColor.YELLOW+"[Island Helper] "+ChatColor.WHITE;
lang[1]="Welcome to use Island Helper.Made by QingChenW.";
lang[2]="Js version is "+JsVersion+",Game version is "+GameVersion;
lang[3]="print '/ishelp' to see help";
lang[4]="Island Helper JS.Made by QingChenW.";
lang[5]="stone digger help:\nPlace a digger on cobblestone,then place a chest on the digger and throw a pickaxe in the first slot of the chest,point the digger,then it will dig the cobblestone under it,when it dig a cobblestone,the damage of the pickaxe will - one,use it with a cobblestone machine will do better,every save can only open a digger,this isn't a Bug!";
lang[6]="stone digger was open!point it to stop!";
lang[7]="stone digger was closed!";
lang[8]="every save can only open a digger,this isn't a Bug!";
lang[9]="the pickaxe is bad.stone digger was closed!";
lang[10]="the chest is filled.stone digger was closed!";
lang[11]="please place a chest on the digger and throw a pickaxe in the first slot of the chest.";
lang[12]="stone digger can only dig cobblestone!";
lang[13]="stone digger was destroyed!";
lang[14]="obsidian has already turned into lava,please be careful!";
break;

default:print("错误,无法加载语言");break;
}
}

//加载存档
function newLevel()
{
if($!="net.zhuoweizhang.mcpelauncher" && $!="net.zhuoweizhang.mcpelauncher.pro")
{
ctx.runOnUiThread(new java.lang.Runnable({run:function(){
ctx.finish();
}}));
}
clientMessage(lang[0]+lang[1]);
clientMessage(lang[0]+lang[2]);
if(!isNaN(newVersion))
{
/*if(newVersion <= JsVersion)
{
clientMessage(lang[0]+"您当前使用的是最新版本的JS);
}
else
{
clientMessage(lang[0]+"发现新版本，请更新");
}*/
}
else
{
clientMessage(lang[0]+"无法获取更新，请检查网络连接");
}
clientMessage(lang[0]+lang[3]);
if(bombpre == true)
{
for(var $i =0 ;$i <= 255 ;$i ++)
{
Block.setExplosionResistance($i, 10000);
}
}
if(keepinv == true)
{
clientMessage(lang[0]+ChatColor.RED+"警告: "+ChatColor.WHITE+"死亡不掉落不支持经验和附魔工具。\n并且请勿在打开死亡不掉落时死亡后回到主菜单并退出，否则将丢失全部物品!");
}
ctx.runOnUiThread(new java.lang.Runnable({run:function()
{
try{
//菜单按钮
gui=new android.widget.PopupWindow();
var layout=new android.widget.RelativeLayout(ctx);
var button=new android.widget.Button(ctx);
button.setText("空岛菜单");
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
//打开菜单
openMenu();
//结束菜单
}}));
layout.addView(button);
gui.setContentView(layout);
gui.setWidth(192);
gui.setHeight(96);
gui.showAtLocation(ctx.getWindow().getDecorView(),android.view.Gravity.RIGHT|android.view.Gravity.BOTTOM,0,0);
//MP3按钮
MP3=new android.widget.PopupWindow();
var mp3lay=new android.widget.LinearLayout(ctx);
var button=new android.widget.Button(ctx);
button.setText("🎵");
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
//打开菜单
openMP3();
//结束菜单
}}));
mp3lay.addView(button);
MP3.setContentView(mp3lay);
MP3.setWidth(96);
MP3.setHeight(96);
MP3.showAtLocation(ctx.getWindow().getDecorView(),android.view.Gravity.LEFT|android.view.Gravity.BOTTOM,0,480);
//logo
var logolay = new android.widget.LinearLayout(ctx);
var Params = new android.widget.LinearLayout.LayoutParams(-1,-1,1);
logo = new android.widget.PopupWindow(logolay,dip2px(ctx,96),dip2px(ctx,64));
logoimg = new android.widget.ImageView(ctx);
logotext = new android.widget.TextView(ctx);
logolay.setOrientation(1);
logoimg.setScaleType(android.widget.ImageView.ScaleType.CENTER_CROP);
logoimg.setLayoutParams(Params);
logoimg.setImageBitmap(image);
logotext.setText("Wdawning");
logotext.setTextSize(18);
logotext.setGravity(17);
logotext.setTextColor(android.graphics.Color.BLACK);
logolay.addView(logoimg);
logolay.addView(logotext);
logo.setTouchable(false);
logo.showAtLocation(ctx.getWindow().getDecorView(), android.view.Gravity.RIGHT | android.view.Gravity.TOP, 5, 5);
alpha = 1;
logostart();
if(map == true){openmap();}
if(language == "auto"){chlanguage();}
}
catch(err){print("Error:"+err);
}}}))
}

//计算
function dip2px(ctx,dips)
{
return Math.ceil(dips*ctx.getResources().getDisplayMetrics().density);
}

function makeMenu(ctx,layout)
{ 
var mlayout=new android.widget.RelativeLayout(ctx)
var svParams=new android.widget.RelativeLayout.LayoutParams(android.widget.RelativeLayout.LayoutParams.FILL_PARENT,android.widget.RelativeLayout.LayoutParams.FILL_PARENT) 
var scrollview=new android.widget.ScrollView(ctx) 
var pad=dip2px(ctx,2) 
scrollview.setPadding(pad,pad,pad,pad) 
scrollview.setLayoutParams(svParams) 
scrollview.addView(layout) 
mlayout.addView(scrollview) 
return mlayout 
}

//配置文件
function save(path, filename, content)
{
try{
java.io.File(path).mkdirs();
var newFile = new java.io.File(path, filename);
newFile.createNewFile();
var outWrite = new java.io.OutputStreamWriter(new java.io.FileOutputStream(newFile));
outWrite.append(content);
outWrite.close();
}catch(e){
print("save, " + e + " (" + e.fileName + " #" + e.lineNumber + ")");
}
}

function load(path, filename)
{
var content = "";
if(java.io.File(path + filename).exists())
{
var file = new java.io.File(path + filename),
fos = new java.io.FileInputStream(file),
str = new java.lang.StringBuilder(),
ch;
while((ch = fos.read()) != -1)
{
str.append(java.lang.Character(ch)); }
content = String(str.toString());
fos.close();
}
return content;
}

function loadTxtFromUrl(url)
{
try{
var content = new java.io.ByteArrayOutputStream();
android.net.http.AndroidHttpClient.newInstance("userAgent").execute(new org.apache.http.client.methods.HttpGet(url)).getEntity().writeTo(content);
content.close();
return String(content.toString());
}catch(e)
{
return "";
}
}

function savesettings()
{
save(worldsdir+Level.getWorldDir(), "isoption.txt", "//The settings of WC's island helper.\nJsVersion:"+JsVersion+"\nGameVersion:"+GameVersion+"\nlanguage:"+language+"\nkittools:"+kittools+"\nsmallmap:"+map+"\nhealth:"+hp+"\ncutwoods:"+cut+"\nbukkit:"+bukkit+"\nkeepInventory:"+keepinv+"\nbombprevent:"+bombpre+"\nstopenderman:"+ender);
}

//logo
function logostart()
{
new android.os.Handler().postDelayed(new java.lang.Runnable(
{
run: function() 
{
if(alpha >= 0)
{
logoimg.setAlpha(alpha);
logotext.setAlpha(alpha);
alpha = alpha - 0.01;
logostart();
}
else
{
if(logo != null)
{
logo.dismiss();
}
}
}
}),50);
}

//MP3
function openMP3()
{
var layout=new android.widget.LinearLayout(ctx);
var blayout=new android.widget.LinearLayout(ctx);
try{
layout.setOrientation(android.widget.LinearLayout.VERTICAL);

var text = new android.widget.TextView(ctx);
mp3seek = new android.widget.SeekBar(ctx);

if(mp3 != null){
text.setText("正在播放的音乐:\n"+music);
mp3seek.setMax(mp3.getDuration());
}
else{text.setText("未播放音乐");}
text.setTextSize(14);
text.setTextColor(android.graphics.Color.rgb(255,255,255));
layout.addView(text);
layout.addView(mp3seek);

mp3seek.setOnSeekBarChangeListener(new android.widget.SeekBar.OnSeekBarChangeListener({onStopTrackingTouch:function(v){
if(mp3!=null)
{
mp3.seekTo(mp3seek.getProgress());
}
}}));

var button=new android.widget.ImageButton(ctx);
button.setBackgroundDrawable(null);
button.setImageDrawable(ctx.getResources().getDrawable(android.R.drawable.ic_media_previous));
button.setOnClickListener(new android.view.View.OnClickListener({
onClick:function(v){
//playmusic();
}}))
blayout.addView(button);
var mbutton=new android.widget.ImageButton(ctx);
mbutton.setBackgroundDrawable(null);
if(mp3 != null && mp3.isPlaying())
{
mbutton.setImageDrawable(ctx.getResources().getDrawable(android.R.drawable.ic_media_pause));
}
else
{
mbutton.setImageDrawable(ctx.getResources().getDrawable(android.R.drawable.ic_media_play));
}
mbutton.setOnClickListener(new android.view.View.OnClickListener({
onClick:function(v){
try{
if(mp3 != null)
{
text.setText("正在播放的音乐:\n"+music);
if(mp3.isPlaying())
{
mp3.pause();
mbutton.setImageDrawable(ctx.getResources().getDrawable(android.R.drawable.ic_media_play))
}
else
{
mp3.start();
mbutton.setImageDrawable(ctx.getResources().getDrawable(android.R.drawable.ic_media_pause))
}
}
if(mp3 == null)
{
if(music == null){print("未选择音乐");}
else{
playmusic();
text.setText("正在播放的音乐:\n"+music);
mbutton.setImageDrawable(ctx.getResources().getDrawable(android.R.drawable.ic_media_pause))
}
}
}catch(err){print2("错误:"+err+"可能该音乐文件已删除")}
}}))
blayout.addView(mbutton);
var button=new android.widget.Button(ctx);
button.setText("▇▇");
//button.setTextSize(13);
button.setBackgroundDrawable(new android.graphics.drawable.ColorDrawable(android.graphics.Color.argb(0,0,0,0)));
button.setOnClickListener(new android.view.View.OnClickListener(){
onClick: function(v){
if(mp3 != null && mp3.isPlaying())
{
mp3.stop();
mp3.release();
mp3=null;
text.setText("未播放音乐");
mbutton.setImageDrawable(ctx.getResources().getDrawable(android.R.drawable.ic_media_play))
}
else
{
print("未播放音乐");
}
}});
blayout.addView(button);
var button=new android.widget.ImageButton(ctx);
button.setBackgroundDrawable(null);
button.setImageDrawable(ctx.getResources().getDrawable(android.R.drawable.ic_media_next));
button.setOnClickListener(new android.view.View.OnClickListener({
onClick:function(v){
//playmusic();
}}))
blayout.addView(button);
layout.addView(blayout);
var rbutton=new android.widget.Button(ctx);
if(replay == true)
{
rbutton.setText("循环播放");
}
else
{
rbutton.setText("单曲播放");
}
rbutton.setTextSize(11);
rbutton.setBackgroundDrawable(new android.graphics.drawable.ColorDrawable(android.graphics.Color.argb(0,0,0,0)));
rbutton.setOnClickListener(new android.view.View.OnClickListener(){
onClick: function(v){
if(replay == true)
{
rbutton.setText("单曲播放");
replay = false;
}
else
{
rbutton.setText("循环播放");
replay = true;
}
}});
blayout.addView(rbutton);

var button = new android.widget.Button(ctx);
button.setText("选择音乐");
button.setOnClickListener(new android.view.View.OnClickListener(){onClick: function(p){
selectmusic();
Dialog.dismiss();
}});
layout.addView(button);

//Dialog
var Dialog = new android.app.Dialog(ctx);
Dialog.setContentView(layout);
Dialog.setTitle("超级简单的MP3播放器");

Dialog.show();
}catch(err){print("错误: "+err+".");
}}

function selectmusic()
{
var layout=new android.widget.LinearLayout(ctx);
try{
layout.setOrientation(android.widget.LinearLayout.VERTICAL);

var dialog=new android.app.Dialog(ctx);
dialog.setTitle("添加音乐");
dialog.setContentView(layout);

var text=new android.widget.EditText(ctx);
text.setHint("请在此输入歌曲路径\n例如:/sdcard/xxxx.mp3");
layout.addView(text);

var button=new android.widget.Button(ctx);
button.setText("确定");
button.setOnClickListener(new android.view.View.OnClickListener({onClick: function(v)
{
if(text.getText() != "" && java.io.File(text.getText()).exists() && java.io.File(text.getText()).isFile())
{
try{
music = text.getText();
playmusic();
openMP3();
dialog.dismiss();
}
catch(err){print("错误:"+err+"不是音乐文件")}
}
else
{
print("错误:文件路径无效");
}
}}));
layout.addView(button);
dialog.show();
}catch(err){print(err);}
}

function playmusic()
{
if(mp3 != null && mp3.isPlaying())
{
mp3.stop();
mp3.release();
mp3=null;
}
mp3=new android.media.MediaPlayer();
mp3.setDataSource(music);
mp3.prepare();
mp3.start();
mp3seek.setMax(mp3.getDuration());
mp3.setOnCompletionListener(new android.media.MediaPlayer.OnCompletionListener({
onCompletion:function(v){
try{
if(replay == true){mp3.start();}
}
catch(err){print("错误"+err+"可能该音乐文件已删除")}
}}));
}

//各种菜单
function openMenu()
{
var layout=new android.widget.LinearLayout(ctx);
try{
var menu=new android.widget.PopupWindow(layout,dip2px(ctx,70), dip2px(ctx,30)); 
menu.setFocusable(true);
layout.setOrientation(1);
//菜单
//标题
var textParams=new android.widget.LinearLayout.LayoutParams(android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT, android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT);
textParams.setMargins(dip2px(ctx, 5), 0, 0, 0);
var title=new android.widget.TextView(ctx);
title.setTextSize(24);
title.setTextColor(android.graphics.Color.rgb(255,255,255));
title.setText("空岛帮手菜单");
title.setLayoutParams(textParams);
layout.addView(title);
var stitle=new android.widget.TextView(ctx);
stitle.setTextSize(17);
stitle.setTextColor(android.graphics.Color.rgb(255,255,255));
stitle.setText("作者 QingChenW");
stitle.setLayoutParams(textParams);
layout.addView(stitle);
//打开物品菜单
var button=new android.widget.Button(ctx);
button.setText("任务和交易");
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
openWPMenu();
}}));
layout.addView(button);
//小地图
var button=new android.widget.ToggleButton(ctx);
button.setTextOn("小地图开");
button.setTextOff("小地图关");
button.setChecked(map);
button.setTextSize(18);
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(){
if(map){map = false;
mapop.dismiss();
clientMessage(lang[0]+"小地图已关闭。");}
else{map = true;
openmap();
clientMessage(lang[0]+"小地图已开启。");}
}}));
layout.addView(button);
//显血
var button=new android.widget.ToggleButton(ctx);
button.setTextOn("显血开");
button.setTextOff("显血关");
button.setChecked(hp);
button.setTextSize(18);
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(){
if(hp){hp = false;
clientMessage(lang[0]+"血量显示已关闭。");}
else{hp = true;
clientMessage(lang[0]+"血量显示已开启。");}
}}));
layout.addView(button);
//砍树
var button=new android.widget.ToggleButton(ctx);
button.setTextOn("快速砍树开");
button.setTextOff("快速砍树关");
button.setTextSize(18);
button.setChecked(cut);
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(){
if(cut){cut = false}
else
{cut = true;
clientMessage(lang[0]+"快速砍树已开启。");}
}}));
layout.addView(button);
//黑曜石变岩浆
var button=new android.widget.ToggleButton(ctx);
button.setTextOn("黑曜石变岩浆开");
button.setTextOff("黑曜石变岩浆关");
button.setTextSize(16);
button.setChecked(bukkit);
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(){
if(bukkit){bukkit = false}
else
{bukkit = true;
clientMessage(lang[0]+"用空桶单击黑曜石即可将黑曜石变为岩浆。");}
}}));
layout.addView(button);
//死亡不掉落
var tick=new android.widget.CheckBox(ctx);
tick.setTextColor(android.graphics.Color.WHITE);
tick.setText("死亡不掉落");
tick.setChecked(keepinv);
tick.setOnCheckedChangeListener(new android.widget.CompoundButton.OnCheckedChangeListener(){
onCheckedChanged:function(v, isChecked){
if(isChecked){keepinv = isChecked;
clientMessage(lang[0]+"死亡不掉落已开启。");
clientMessage(ChatColor.YELLOW+"[空岛帮手] "+ChatColor.RED+"警告:"+ChatColor.WHITE+"死亡不掉落不支持经验和附魔工具。\n并且请勿在打开死亡不掉落时死亡后回到主菜单并退出，否则将丢失全部物品!");}
else{keepinv = isChecked;
clientMessage(lang[0]+"死亡不掉落已关闭。");}
}});
layout.addView(tick);
//防爆
var tick=new android.widget.CheckBox(ctx);
tick.setTextColor(android.graphics.Color.WHITE);
tick.setText("防爆");
tick.setChecked(bombpre);
tick.setOnCheckedChangeListener(new android.widget.CompoundButton.OnCheckedChangeListener(){
onCheckedChanged:function(v, isChecked){
if(isChecked){bombpre = isChecked;
for(var $i =0 ;$i <= 255 ;$i ++)
{
Block.setExplosionResistance($i, 10000);
}
clientMessage(lang[0]+"防爆已开启！可以在菜单中关闭！");}
else{bombpre = isChecked;
for(var $i =0 ;$i <= 255 ;$i ++)
{
Block.setExplosionResistance($i, 3);
}
clientMessage(lang[0]+"防爆已关闭！");}
}});
layout.addView(tick);
//禁止刷小黑
var tick=new android.widget.CheckBox(ctx);
tick.setTextColor(android.graphics.Color.WHITE);
tick.setText("禁止刷小黑");
tick.setChecked(ender);
tick.setOnCheckedChangeListener(new android.widget.CompoundButton.OnCheckedChangeListener(){
onCheckedChanged:function(v, isChecked){
if(isChecked){ender = isChecked;
clientMessage(lang[0]+"禁止刷小黑已开启。");}
else{ender = isChecked;
clientMessage(lang[0]+"禁止刷小黑已关闭。");}
}});
layout.addView(tick);
//打开作弊菜单
var button=new android.widget.Button(ctx);
button.setText("作弊菜单");
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
openZbMenu();
}}));
layout.addView(button);
//打开建筑菜单
var button=new android.widget.Button(ctx);
button.setText("建筑菜单");
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
openBlMenu();
}}));
layout.addView(button);
//更改语言
var button=new android.widget.Button(ctx);
button.setText("更改语言");
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
chlanguage();
}}));
layout.addView(button);
//彩蛋
var button=new android.widget.Button(ctx);
button.setText("彩蛋");
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
coloreggs();
}}));
layout.addView(button);
//打开关于
var button=new android.widget.Button(ctx);
button.setText("关于");
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
about();
}}));
layout.addView(button);
//结束
var mlayout=makeMenu(ctx,layout);
menu.setContentView(mlayout);
menu.setWidth(ctx.getWindowManager().getDefaultDisplay().getWidth()*0.25);
menu.setHeight(ctx.getWindowManager().getDefaultDisplay().getHeight());
menu.setBackgroundDrawable(new android.graphics.drawable.ColorDrawable(android.graphics.Color.argb(63,0,0,0)));
menu.showAtLocation(ctx.getWindow().getDecorView(),android.view.Gravity.RIGHT | android.view.Gravity.TOP,0,0);
}
catch(err){print("Error:"+err);
}}

//任务和交易
function openWPMenu()
{
var layout=new android.widget.LinearLayout(ctx);
try{
var wpmenu=new android.widget.PopupWindow(layout,dip2px(ctx,70), dip2px(ctx,30)); 
wpmenu.setFocusable(true);
layout.setOrientation(1);
//菜单
//标题
var textParams=new android.widget.LinearLayout.LayoutParams(android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT, android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT);
textParams.setMargins(dip2px(ctx, 5), 0, 0, 0);
var title=new android.widget.TextView(ctx);
title.setTextSize(20);
title.setTextColor(android.graphics.Color.rgb(255,255,255));
title.setText("物品和任务");
title.setLayoutParams(textParams);
layout.addView(title);
//给予初始装备
var button=new android.widget.Button(ctx);
button.setText("领取初始装备\n(仅限一次)");
button.setTextSize(15);
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
if(Level.getGameMode() == 0){
if(kittools == false){
kittools = true;
//获得新手物品
Player.addItemInventory(79,2,0);
Player.addItemInventory(325,1,10);
Player.addItemInventory(15,3,0);
Player.addItemInventory(50,4,0);
Player.addItemInventory(12,3,0);
Player.addItemInventory(13,1,0);
Player.addItemInventory(110,1,0);
Player.addItemInventory(6,1,0);
Player.addItemInventory(6,4,3);
Player.addItemInventory(295,3,0);
Player.addItemInventory(458,2,0);
Player.addItemInventory(391,1,0);
Player.addItemInventory(392,1,0);
Player.addItemInventory(360,1,0);
Player.addItemInventory(361,1,0);
Player.addItemInventory(338,2,0);
Player.addItemInventory(81,2,0);
Player.addItemInventory(351,1,3);
Player.addItemInventory(39,1,0);
Player.addItemInventory(40,1,0);
Player.addItemInventory(351,3,15);
Player.addItemInventory(383,1,10);
savesettings();
//结束
clientMessage(lang[0]+"给予玩家 初始装备 X1！");
}
else{
clientMessage(lang[0]+"你都已经领过一次了，不要贪心哦！");
}
}
else{
clientMessage(lang[0]+"只有生存才能使用哦~");
}
}}));
layout.addView(button);
//任务
var button=new android.widget.Button(ctx);
button.setText("挑战任务");
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
quest();
}}));
layout.addView(button);
//商店
var button=new android.widget.Button(ctx);
button.setText("商店菜单");
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
trade();
}}));
layout.addView(button);
//给予物品
var button=new android.widget.Button(ctx);
button.setText("获得物品");
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
give();
}}));
layout.addView(button);
//结束
var mlayout=makeMenu(ctx,layout);
wpmenu.setContentView(mlayout);
wpmenu.setWidth(ctx.getWindowManager().getDefaultDisplay().getWidth()*0.20);
wpmenu.setHeight(ctx.getWindowManager().getDefaultDisplay().getHeight());
wpmenu.setBackgroundDrawable(new android.graphics.drawable.ColorDrawable(android.graphics.Color.argb(31,0,0,0)));
wpmenu.showAtLocation(ctx.getWindow().getDecorView(),android.view.Gravity.RIGHT | android.view.Gravity.TOP,ctx.getWindowManager().getDefaultDisplay().getWidth()*0.25,0);
}
catch(err){print("Error:"+err); 
}}

function quest()
{
var layout=new android.widget.LinearLayout(ctx);
try{
var quest=new android.widget.PopupWindow(layout,dip2px(ctx,70), dip2px(ctx,30)); 
quest.setFocusable(true);
layout.setOrientation(1);
//菜单
//标题
var textParams=new android.widget.LinearLayout.LayoutParams(android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT, android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT);
textParams.setMargins(dip2px(ctx, 5), 0, 0, 0);
var title=new android.widget.TextView(ctx);
title.setTextSize(20);
title.setTextColor(android.graphics.Color.rgb(255,255,255));
title.setText("挑战任务");
title.setLayoutParams(textParams);
layout.addView(title);
//任务:圆石收集者
var button=new android.widget.Button(ctx);
button.setText("圆石收集者");
button.setTextSize(18);
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
if(Level.getGameMode() == 0)
{
for(var islot = 9;islot <= 44;islot++)
{
if(Player.getInventorySlot(islot) == 4 && Player.getInventorySlotCount(islot) == 64)
{
Player.clearInventorySlot(islot);
Player.addItemInventory(388,1,0);
clientMessage(lang[0]+"恭喜玩家"+Player.getName(Player.getEntity())+"完成任务:圆石收集者！获得1个绿宝石！");
break;
}
}
if(islot > 35)
{
clientMessage(lang[0]+"这个任务需要64个圆石来完成哦！");
}
}
else
{
clientMessage(lang[0]+"生存才能做任务哦！");
}
}}));
layout.addView(button);
//结束
var mlayout=makeMenu(ctx,layout);
quest.setContentView(mlayout);
quest.setWidth(ctx.getWindowManager().getDefaultDisplay().getWidth()*0.15);
quest.setHeight(ctx.getWindowManager().getDefaultDisplay().getHeight());
quest.setBackgroundDrawable(new android.graphics.drawable.ColorDrawable(android.graphics.Color.argb(15,0,0,0)));
quest.showAtLocation(ctx.getWindow().getDecorView(),android.view.Gravity.RIGHT | android.view.Gravity.TOP,ctx.getWindowManager().getDefaultDisplay().getWidth()*0.45,0);
}
catch(err){print("Error:"+err);
}}

function trade()
{
var layout=new android.widget.LinearLayout(ctx);
try{
var trade=new android.widget.PopupWindow(layout,dip2px(ctx,70), dip2px(ctx,30)); 
trade.setFocusable(true);
layout.setOrientation(1);
//菜单
//标题
var textParams=new android.widget.LinearLayout.LayoutParams(android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT, android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT);
textParams.setMargins(dip2px(ctx, 5), 0, 0, 0);
var title=new android.widget.TextView(ctx);
title.setTextSize(20);
title.setTextColor(android.graphics.Color.rgb(255,255,255));
title.setText("商店菜单");
title.setLayoutParams(textParams);
layout.addView(title);
//结束
var mlayout=makeMenu(ctx,layout);
trade.setContentView(mlayout);
trade.setWidth(ctx.getWindowManager().getDefaultDisplay().getWidth()*0.15);
trade.setHeight(ctx.getWindowManager().getDefaultDisplay().getHeight());
trade.setBackgroundDrawable(new android.graphics.drawable.ColorDrawable(android.graphics.Color.argb(15,0,0,0)));
trade.showAtLocation(ctx.getWindow().getDecorView(),android.view.Gravity.RIGHT | android.view.Gravity.TOP,ctx.getWindowManager().getDefaultDisplay().getWidth()*0.45,0);
}
catch(err){print("Error:"+err);
}}

function give()
{
var layout=new android.widget.LinearLayout(ctx);
try{
var give=new android.widget.PopupWindow(layout,dip2px(ctx,70), dip2px(ctx,30)); 
give.setFocusable(true);
layout.setOrientation(1);
//菜单
//标题
var textParams=new android.widget.LinearLayout.LayoutParams(android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT, android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT);
textParams.setMargins(dip2px(ctx, 5), 0, 0, 0);
var title=new android.widget.TextView(ctx);
title.setTextSize(20);
title.setTextColor(android.graphics.Color.rgb(255,255,255));
title.setText("物品菜单");
title.setLayoutParams(textParams);
layout.addView(title);
//给予挖石机
var button=new android.widget.Button(ctx);
button.setText("获得挖石机");
button.setTextSize(13);
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
if(Level.getGameMode() == 0){
Player.addItemInventory(255,1,0);
}
if(Level.getGameMode() == 1){
Entity.setCarriedItem(Player.getEntity(),255,1,0);
}
clientMessage(lang[0]+"给予玩家 挖石机 X1！");
}}));
layout.addView(button);
//用ID获得
var button=new android.widget.Button(ctx);
button.setText("添加物品");
button.setTextSize(15);
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
TooManyItems();
}}));
layout.addView(button);
//背包
var button=new android.widget.Button(ctx);
button.setText("清空背包");
button.setTextSize(15);
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
for(var islot = 9;islot <= 44;islot++)
{
Player.clearInventorySlot(islot);
//Player.addItemInventory(4,64,0);
}
}}));
layout.addView(button);
//结束
var mlayout=makeMenu(ctx,layout);
give.setContentView(mlayout);
give.setWidth(ctx.getWindowManager().getDefaultDisplay().getWidth()*0.15);
give.setHeight(ctx.getWindowManager().getDefaultDisplay().getHeight());
give.setBackgroundDrawable(new android.graphics.drawable.ColorDrawable(android.graphics.Color.argb(15,0,0,0)));
give.showAtLocation(ctx.getWindow().getDecorView(),android.view.Gravity.RIGHT | android.view.Gravity.TOP,ctx.getWindowManager().getDefaultDisplay().getWidth()*0.45,0);
}
catch(err){print("Error:"+err);
}}

function TooManyItems()
{
var number = android.text.InputType.TYPE_CLASS_NUMBER;
var tmiLayout = new android.widget.LinearLayout(ctx);
try{
//TooManyItems
var id = new android.widget.EditText(ctx);
var amount = new android.widget.EditText(ctx);
var data = new android.widget.EditText(ctx);
var add = new android.widget.Button(ctx);

add.setText("添加物品")
id.setHint("物品序号（ID）");
amount.setHint("数量");
data.setHint("特殊数据值");
id.setInputType(number);
amount.setInputType(number);
data.setInputType(number);

tmiLayout.setOrientation(android.widget.LinearLayout.VERTICAL);
tmiLayout.addView(id);
tmiLayout.addView(amount);
tmiLayout.addView(data);
tmiLayout.addView(add);

//Dialogs
var tmiDialog = new android.app.Dialog(ctx);
tmiDialog.setContentView(tmiLayout);
tmiDialog.setTitle("添加物品");

add.setOnClickListener(new android.view.View.OnClickListener(){onClick:function(){

var itemId = id.getText();
var iAmount = amount.getText();
var iData = data.getText();

if(itemId == null){itemId = 0;}
if(iAmount<=0){iAmount = 1;}
if(idata == null){idata = 0;}

if(Level.getGameMode() == 0){
Player.addItemInventory(itemId,iAmount,iData);
}
if(Level.getGameMode() == 1){
Entity.setCarriedItem(Player.getEntity(),itemId,iAmount,iData);
}
clientMessage(lang[0]+"给予玩家 "+itemId+":"+iData+" X"+iAmount+"！");

tmiDialog.dismiss();
}});
tmiDialog.show();
}catch(err){
print("错误: "+err+".");
}}

//小地图
function openmap()
{
var layout=new android.widget.LinearLayout(ctx);
try{
mapop = new android.widget.PopupWindow(layout,dip2px(ctx,128),dip2px(ctx,144));
layout.setOrientation(1);
var mapopx = 56;
var mapopy = 48;
var mX,mY;
//地图
var textParams=new android.widget.LinearLayout.LayoutParams(android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT, android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT);
textParams.setMargins(dip2px(ctx, 5), 0, 0, 0);
var text=new android.widget.TextView(ctx);
text.setTextSize(13);
text.setGravity(17);
text.setTextColor(android.graphics.Color.rgb(255,255,255));
text.setText("其实我不会做小地图\n看我不顺眼\n可以在菜单中关闭\n其实按住我可以拖动\nQAQ");
text.setLayoutParams(textParams);
text.setOnTouchListener(new android.view.View.OnTouchListener(
{
onTouch :function(v, e)
{
switch (e.getAction())
{
case 0:
mX = e.getX();
mY = e.getY();
break;
case 2:
var delX=parseInt(e.getX() - mX);
var delY=parseInt(e.getY() - mY);
mapopx = mapopx + delX;
mapopy = mapopy + delY;
mapop.update(parseFloat(mapopx), parseFloat(mapopy), -1, -1);
break;
}
return true;
}
}));
layout.addView(text);

pos=new android.widget.TextView(ctx);
pos.setTextSize(14);
pos.setGravity(17);
pos.setTextColor(android.graphics.Color.rgb(255,255,255));
pos.setText("X:"+parseInt(Player.getX())+" Y:"+parseInt(Player.getY()-1)+" Z:"+parseInt(Player.getZ()));
pos.setLayoutParams(textParams);
layout.addView(pos);
//结束
mapop.setBackgroundDrawable(new android.graphics.drawable.ColorDrawable(android.graphics.Color.argb(31,0,0,0)));
mapop.showAtLocation(ctx.getWindow().getDecorView(), android.view.Gravity.LEFT | android.view.Gravity.TOP, mapopx, mapopy);
mapupdate();
}
catch(err){print("Error:"+err);
}}

function mapupdate()
{
new android.os.Handler().postDelayed(new java.lang.Runnable(
{
run: function() 
{
if(map == true)
{
pos.setText("X:"+parseInt(Player.getX())+" Y:"+parseInt(Player.getY()-1)+" Z:"+parseInt(Player.getZ()));
mapupdate();
}
}
}),400);
}

//作弊菜单
function openZbMenu()
{
var layout=new android.widget.LinearLayout(ctx);
try{
var zbmenu=new android.widget.PopupWindow(layout,dip2px(ctx,70), dip2px(ctx,30)); 
zbmenu.setFocusable(true);
layout.setOrientation(1);
//菜单
//标题
var textParams=new android.widget.LinearLayout.LayoutParams(android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT, android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT);
textParams.setMargins(dip2px(ctx, 5), 0, 0, 0);
var title=new android.widget.TextView(ctx);
title.setTextSize(20);
title.setTextColor(android.graphics.Color.rgb(255,255,255));
title.setText("作弊菜单");
title.setLayoutParams(textParams);
layout.addView(title);
//改游戏模式
var button=new android.widget.Button(ctx)
button.setText("游戏模式")
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
gamemode();
}}));
layout.addView(button);
//改游戏时间
var button=new android.widget.Button(ctx)
button.setText("游戏时间")
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
gametime();
}}));
layout.addView(button);
//改游戏天气
/*var button=new android.widget.Button(ctx)
button.setText("游戏天气")
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
gameweather();
}}));
layout.addView(button);*/
//传送
var button=new android.widget.Button(ctx)
button.setText("玩家位置")
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
tppos();
}}));
layout.addView(button);
//变速
var button=new android.widget.Button(ctx)
button.setText("变速")
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
changespeed();
}}));
layout.addView(button);
//结束
var mlayout=makeMenu(ctx,layout);
zbmenu.setContentView(mlayout);
zbmenu.setWidth(ctx.getWindowManager().getDefaultDisplay().getWidth()*0.20);
zbmenu.setHeight(ctx.getWindowManager().getDefaultDisplay().getHeight());
zbmenu.setBackgroundDrawable(new android.graphics.drawable.ColorDrawable(android.graphics.Color.argb(31,0,0,0)));
zbmenu.showAtLocation(ctx.getWindow().getDecorView(),android.view.Gravity.RIGHT | android.view.Gravity.TOP,ctx.getWindowManager().getDefaultDisplay().getWidth()*0.25,0);
}
catch(err){print("Error:"+err); 
}}

function gamemode()
{
var layout=new android.widget.LinearLayout(ctx);
try{
var gamemode=new android.widget.PopupWindow(layout,dip2px(ctx,70), dip2px(ctx,30)); 
gamemode.setFocusable(true);
layout.setOrientation(1);
//菜单
//标题
var textParams=new android.widget.LinearLayout.LayoutParams(android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT, android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT);
textParams.setMargins(dip2px(ctx, 5), 0, 0, 0);
var title=new android.widget.TextView(ctx);
title.setTextSize(18);
title.setTextColor(android.graphics.Color.rgb(255,255,255));
title.setText("游戏模式");
title.setLayoutParams(textParams);
layout.addView(title);
//生存
var button=new android.widget.Button(ctx);
button.setText("生存");
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
Level.setGameMode(0);
clientMessage(lang[0]+"您的游戏模式已更新为生存！");
}}));
layout.addView(button);
//创造
var button=new android.widget.Button(ctx);
button.setText("创造");
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
Level.setGameMode(1);
clientMessage(lang[0]+"您的游戏模式已更新为创造！");
}}));
layout.addView(button);
//飞行
var tick=new android.widget.CheckBox(ctx);
tick.setTextColor(android.graphics.Color.WHITE);
tick.setText("飞行");
tick.setChecked(Player.canFly());
tick.setOnCheckedChangeListener(new android.widget.CompoundButton.OnCheckedChangeListener(){
onCheckedChanged:function(v, isChecked){
if(isChecked){Player.setCanFly(true);
clientMessage(lang[0]+"飞行已开启。");}
else{Player.setCanFly(false);
clientMessage(lang[0]+"飞行已关闭。");}
}});
layout.addView(tick);
//结束
var mlayout=makeMenu(ctx,layout);
gamemode.setContentView(mlayout);
gamemode.setWidth(ctx.getWindowManager().getDefaultDisplay().getWidth()*0.15);
gamemode.setHeight(ctx.getWindowManager().getDefaultDisplay().getHeight());
gamemode.setBackgroundDrawable(new android.graphics.drawable.ColorDrawable(android.graphics.Color.argb(15,0,0,0)));
gamemode.showAtLocation(ctx.getWindow().getDecorView(),android.view.Gravity.RIGHT | android.view.Gravity.TOP,ctx.getWindowManager().getDefaultDisplay().getWidth()*0.45,0);
}
catch(err){print("Error:"+err);
}}

function gametime()
{
var layout=new android.widget.LinearLayout(ctx);
try{
var gametime=new android.widget.PopupWindow(layout,dip2px(ctx,70), dip2px(ctx,30)); 
gametime.setFocusable(true);
layout.setOrientation(1);
//菜单
//标题
var textParams=new android.widget.LinearLayout.LayoutParams(android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT, android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT);
textParams.setMargins(dip2px(ctx, 5), 0, 0, 0);
var title=new android.widget.TextView(ctx);
title.setTextSize(18);
title.setTextColor(android.graphics.Color.rgb(255,255,255));
title.setText("游戏时间");
title.setLayoutParams(textParams);
layout.addView(title);
//清晨
var button=new android.widget.Button(ctx);
button.setText("清晨");
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
Level.setTime(0);
clientMessage(lang[0]+"您的游戏时间已设置为清晨！");
}}));
layout.addView(button);
//正午
var button=new android.widget.Button(ctx);
button.setText("正午");
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
Level.setTime(6000);
clientMessage(lang[0]+"您的游戏时间已设置为正午！");
}}));
layout.addView(button);
//傍晚
var button=new android.widget.Button(ctx);
button.setText("傍晚");
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
Level.setTime(12000);
clientMessage(lang[0]+"您的游戏时间已设置为傍晚！");
}}));
layout.addView(button);
//午夜
var button=new android.widget.Button(ctx);
button.setText("午夜");
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
Level.setTime(18000);
clientMessage(lang[0]+"您的游戏时间已设置为午夜！");
}}));
layout.addView(button);
//结束
var mlayout=makeMenu(ctx,layout);
gametime.setContentView(mlayout);
gametime.setWidth(ctx.getWindowManager().getDefaultDisplay().getWidth()*0.15);
gametime.setHeight(ctx.getWindowManager().getDefaultDisplay().getHeight());
gametime.setBackgroundDrawable(new android.graphics.drawable.ColorDrawable(android.graphics.Color.argb(15,0,0,0)));
gametime.showAtLocation(ctx.getWindow().getDecorView(),android.view.Gravity.RIGHT | android.view.Gravity.TOP,ctx.getWindowManager().getDefaultDisplay().getWidth()*0.45,0);
}
catch(err){print("Error:"+err);
}}

/*function gameweather()
{
var layout=new android.widget.LinearLayout(ctx);
try{
var gameweather=new android.widget.PopupWindow(layout,dip2px(ctx,70), dip2px(ctx,30)); 
gameweather.setFocusable(true);
layout.setOrientation(1);
//菜单
//标题
var textParams=new android.widget.LinearLayout.LayoutParams(android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT, android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT);
textParams.setMargins(dip2px(ctx, 5), 0, 0, 0);
var title=new android.widget.TextView(ctx);
title.setTextSize(18);
title.setTextColor(android.graphics.Color.rgb(255,255,255));
title.setText("游戏天气");
title.setLayoutParams(textParams);
layout.addView(title);



var mlayout=makeMenu(ctx,layout);
gameweather.setContentView(mlayout);
gameweather.setWidth(ctx.getWindowManager().getDefaultDisplay().getWidth()*0.15);
gameweather.setHeight(ctx.getWindowManager().getDefaultDisplay().getHeight());
gameweather.setBackgroundDrawable(new android.graphics.drawable.ColorDrawable(android.graphics.Color.argb(15,0,0,0)));
gameweather.showAtLocation(ctx.getWindow().getDecorView(),android.view.Gravity.RIGHT | android.view.Gravity.TOP,ctx.getWindowManager().getDefaultDisplay().getWidth()*0.45,0);
}
catch(err){print("Error:"+err);
}}*/

function tppos()
{
var number = android.text.InputType.TYPE_CLASS_NUMBER;
var layout = new android.widget.LinearLayout(ctx);
var xlayout = new android.widget.LinearLayout(ctx);
var ylayout = new android.widget.LinearLayout(ctx);
var zlayout = new android.widget.LinearLayout(ctx);
try{
var s=new android.widget.TextView(ctx)
s.setTextSize(18);
s.setText("  X:  ")
s.setTextColor(android.graphics.Color.rgb(255,255,255));
xlayout.addView(s);

var x=new android.widget.EditText(ctx);
x.setText(String(Player.getX()));
xlayout.addView(x);

var s=new android.widget.TextView(ctx)
s.setTextSize(18);
s.setText("  Y:  ");
s.setTextColor(android.graphics.Color.rgb(255,255,255));
ylayout.addView(s);

var y=new android.widget.EditText(ctx);
y.setText(String(Player.getY()));
ylayout.addView(y);

var s=new android.widget.TextView(ctx)
s.setTextSize(18);
s.setText("  Z:  ");
s.setTextColor(android.graphics.Color.rgb(255,255,255));
zlayout.addView(s);

var z=new android.widget.EditText(ctx);
z.setText(String(Player.getZ()));
zlayout.addView(z);

var add = new android.widget.Button(ctx);
add.setText("传送");

layout.setOrientation(android.widget.LinearLayout.VERTICAL);
layout.addView(xlayout);
layout.addView(ylayout);
layout.addView(zlayout);
layout.addView(add);

//Dialogs
var Dialog = new android.app.Dialog(ctx);
Dialog.setContentView(layout);
Dialog.setTitle("移动到坐标");

add.setOnClickListener(new android.view.View.OnClickListener(){
onClick: function(p){
Entity.setPosition(Player.getEntity(),x.getText(),y.getText(),z.getText());
Dialog.dismiss();
}});

Dialog.show();
}catch(err){
print("错误: "+err+".");
}}

function changespeed()
{
var number = android.text.InputType.TYPE_CLASS_NUMBER;
var layout=new android.widget.LinearLayout(ctx);
try{
var tps = new android.widget.EditText(ctx);
var add = new android.widget.Button(ctx);
var seekbar = new android.widget.SeekBar(ctx);

add.setText("确认")
tps.setHint("默认速度为20");
tps.setText(String(20));
tps.setInputType(number);
seekbar.setMax(100);
seekbar.setProgress(parseInt(tps.getText()));

layout.setOrientation(android.widget.LinearLayout.VERTICAL);
layout.addView(seekbar);
layout.addView(tps);
layout.addView(add);

//Dialog
var Dialog = new android.app.Dialog(ctx);
Dialog.setContentView(layout);
Dialog.setTitle("改变游戏速度");

add.setOnClickListener(new android.view.View.OnClickListener(){
onClick: function(p){
if(parseInt(tps.getText()) > 0)
{
ModPE.setGameSpeed(parseInt(tps.getText()));
clientMessage(lang[0]+"游戏速度切换为普通速度的"+parseInt(tps.getText())/20+"倍");
}
else
{
ModPE.setGameSpeed(20);
clientMessage(lang[0]+"无效数字,切换为普通速度");
}
Dialog.dismiss();
}});
seekbar.setOnSeekBarChangeListener(new android.widget.SeekBar.OnSeekBarChangeListener({onStopTrackingTouch:function(v){
tps.setText(String(seekbar.getProgress()));
}}));
Dialog.show();
}catch(err){print("错误: "+err+".");
}}

//建筑菜单
function openBlMenu()
{
var layout=new android.widget.LinearLayout(ctx);
try{
var blmenu=new android.widget.PopupWindow(layout,dip2px(ctx,70), dip2px(ctx,30)); 
blmenu.setFocusable(true);
layout.setOrientation(1);
//菜单
//标题
var textParams=new android.widget.LinearLayout.LayoutParams(android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT, android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT);
textParams.setMargins(dip2px(ctx, 5), 0, 0, 0);
var title=new android.widget.TextView(ctx);
title.setTextSize(20);
title.setTextColor(android.graphics.Color.rgb(255,255,255));
title.setText("建筑菜单");
title.setLayoutParams(textParams);
layout.addView(title);
//几何体
var button=new android.widget.Button(ctx);
button.setText("几何体");
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
buliding();
}}));
layout.addView(button);
//生成空岛
var button=new android.widget.Button(ctx);
button.setText("生成空岛");
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){

}}));
layout.addView(button);
//改重生点
var button=new android.widget.Button(ctx);
button.setText("设置重生点");
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
setspawn();
}}));
layout.addView(button);
//脚下生方块
var button=new android.widget.Button(ctx);
button.setText("脚下生基岩");
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
settile();
}}));
layout.addView(button);
//结束
var mlayout=makeMenu(ctx,layout);
blmenu.setContentView(mlayout);
blmenu.setWidth(ctx.getWindowManager().getDefaultDisplay().getWidth()*0.20);
blmenu.setHeight(ctx.getWindowManager().getDefaultDisplay().getHeight());
blmenu.setBackgroundDrawable(new android.graphics.drawable.ColorDrawable(android.graphics.Color.argb(31,0,0,0)));
blmenu.showAtLocation(ctx.getWindow().getDecorView(),android.view.Gravity.RIGHT | android.view.Gravity.TOP,ctx.getWindowManager().getDefaultDisplay().getWidth()*0.25,0);
}
catch(err){print("Error:"+err); 
}}

function buliding()
{
var layout=new android.widget.LinearLayout(ctx);
try{
var build=new android.widget.PopupWindow(layout,dip2px(ctx,70), dip2px(ctx,30)); 
build.setFocusable(true);
layout.setOrientation(1);
//菜单
//标题
var textParams=new android.widget.LinearLayout.LayoutParams(android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT, android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT);
textParams.setMargins(dip2px(ctx, 5), 0, 0, 0);
var title=new android.widget.TextView(ctx);
title.setTextSize(20);
title.setTextColor(android.graphics.Color.rgb(255,255,255));
title.setText("几何体");
title.setLayoutParams(textParams);
layout.addView(title);
//两点填充
var button=new android.widget.Button(ctx);
button.setText("两点填充");
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
selectpoint();
}}));
layout.addView(button);
//圆柱

//圆锥

//结束
var mlayout=makeMenu(ctx,layout);
build.setContentView(mlayout);
build.setWidth(ctx.getWindowManager().getDefaultDisplay().getWidth()*0.15);
build.setHeight(ctx.getWindowManager().getDefaultDisplay().getHeight());
build.setBackgroundDrawable(new android.graphics.drawable.ColorDrawable(android.graphics.Color.argb(15,0,0,0)));
build.showAtLocation(ctx.getWindow().getDecorView(),android.view.Gravity.RIGHT | android.view.Gravity.TOP,ctx.getWindowManager().getDefaultDisplay().getWidth()*0.45,0);
}
catch(err){print("Error:"+err);
}}

function selectpoint()
{
if(select == 0)
{
if(Player.getCarriedItem() <= 255)
{
select = 1;
blockid = Player.getCarriedItem();
print("用木锄选择两点");
}
else
{
print("请将要填充的方块拿在手中")
}
}
else
{
select = 0;
print("取消");
}
}

function square()
{
for(var xi = 0;X[1] + xi <= X[2];xi++)
{
for(var yi = 0;Y[1] + yi <= Y[2];yi++)
{
for(var zi = 0;Z[1] + zi <= Z[2];zi++)
{
Level.setTile(X[1]+xi,Y[1]+yi,Z[1]+zi,blockid)
}
}
}
}

function setspawn()
{
Level.setSpawn(Player.getX(),Player.getY(),Player.getZ()
);
clientMessage(lang[0]+"已设置玩家位置为重生点");
}

function settile()
{
var x=parseInt(Player.getX());
var y=parseInt(Player.getY()-2);
var z=parseInt(Player.getZ());
Level.setTile(x,y,z,7);
clientMessage(lang[0]+"在 x:"+x+",y:"+y+",z:"+z+" 处生成基岩");
}

//改变语言
function chlanguage()
{
var layout=new android.widget.LinearLayout(ctx);
try{
var dialog=new android.app.Dialog(ctx);
layout.setOrientation(android.widget.LinearLayout.VERTICAL);
dialog.setTitle("修改语言");
//中文
var button=new android.widget.Button(ctx);
button.setText("中文(中国)");
button.setOnClickListener(new android.view.View.OnClickListener(){onClick:function(){
language = "zh_cn";
savesettings();
clientMessage(ChatColor.YELLOW+"[空岛帮手] "+ChatColor.WHITE+"已设置语言为中文(中国)，重新进入存档生效。");
dialog.dismiss();
}});
layout.addView(button);
//英语
var button=new android.widget.Button(ctx);
button.setText("English(US)");
button.setOnClickListener(new android.view.View.OnClickListener(){onClick:function(){
language = "en_us";
savesettings();
clientMessage(ChatColor.YELLOW+"[Island Helper] "+ChatColor.WHITE+"Set language(English(US)) successfully.Please quit and enter the save.");
dialog.dismiss();
}});
layout.addView(button);

dialog.setContentView(layout);
dialog.show();
}catch(err){print(err)}
}

//更多有趣功能
function coloreggs()
{
var layout=new android.widget.LinearLayout(ctx);
try{
var more=new android.widget.PopupWindow(layout,dip2px(ctx,70), dip2px(ctx,30)); 
more.setFocusable(true);
layout.setOrientation(1);
//菜单
//标题
var textParams=new android.widget.LinearLayout.LayoutParams(android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT, android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT);
textParams.setMargins(dip2px(ctx, 5), 0, 0, 0);
var title=new android.widget.TextView(ctx);
title.setTextSize(20);
title.setTextColor(android.graphics.Color.rgb(255,255,255));
title.setText("彩蛋");
title.setLayoutParams(textParams);
layout.addView(title);
//控制生物
var button=new android.widget.Button(ctx)
button.setText("控制生物")
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){

}}));
layout.addView(button);
//核弹
var button=new android.widget.Button(ctx)
button.setText("核弹")
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
superTNT();
}}));
layout.addView(button);
//望远镜
var button=new android.widget.Button(ctx)
button.setText("望远镜")
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
if(zoop!=null){zoop.dismiss();}
else{fovzoop();}
}}));
layout.addView(button);
//枪械
var button=new android.widget.Button(ctx)
button.setText("射击模式")
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
if(shoot!=null){shoot.dismiss();}
else{openflan();}
}}));
layout.addView(button);
//结束
var mlayout=makeMenu(ctx,layout);
more.setContentView(mlayout);
more.setWidth(ctx.getWindowManager().getDefaultDisplay().getWidth()*0.20);
more.setHeight(ctx.getWindowManager().getDefaultDisplay().getHeight());
more.setBackgroundDrawable(new android.graphics.drawable.ColorDrawable(android.graphics.Color.argb(31,0,0,0)));
more.showAtLocation(ctx.getWindow().getDecorView(),android.view.Gravity.RIGHT | android.view.Gravity.TOP,ctx.getWindowManager().getDefaultDisplay().getWidth()*0.25,0);
}
catch(err){print("Error:"+err);
}}

function superTNT()
{
var number = android.text.InputType.TYPE_CLASS_NUMBER;
var layout=new android.widget.LinearLayout(ctx);
try{
var dialog=new android.app.Dialog(ctx);
layout.setOrientation(android.widget.LinearLayout.VERTICAL);
dialog.setTitle("核弹~啦啦啦");
var word=new android.widget.TextView(ctx);
word.setTextSize(18);
word.setText("威力:");
word.setTextColor(android.graphics.Color.rgb(255,255,255));
layout.addView(word);
var power=new android.widget.EditText(ctx);
power.setText(String(6));
power.setHint("威力");
power.setInputType(number);
layout.addView(power);
var tip=new android.widget.TextView(ctx);
tip.setTextSize(22);
tip.setText("威力建议在18以内，小心卡死");
tip.setTextColor(android.graphics.Color.rgb(255,255,255));
layout.addView(tip);
var bomb=new android.widget.Button(ctx);
bomb.setText("Bomb!");
bomb.setOnClickListener(new android.view.View.OnClickListener(){onClick:function(){
Level.spawnMob(Player.getX(),Player.getY()+3,Player.getZ(),65);
for(var i = 2;i <= power.getText();i = i + 3)
{
Level.spawnMob(Player.getX(),Player.getY()+3,Player.getZ()+i,65);
Level.spawnMob(Player.getX()+i,Player.getY()+3,Player.getZ()+3*i,65);
Level.spawnMob(Player.getX()+i,Player.getY()+3,Player.getZ()+i,65);
Level.spawnMob(Player.getX()+i,Player.getY()+3,Player.getZ(),65);
Level.spawnMob(Player.getX()+3*i,Player.getY()+3,Player.getZ()+i,65);

Level.spawnMob(Player.getX(),Player.getY()+3,Player.getZ()-i,65);
Level.spawnMob(Player.getX()+i,Player.getY()+3,Player.getZ()-3*i,65);
Level.spawnMob(Player.getX()+i,Player.getY()+3,Player.getZ()-i,65);
Level.spawnMob(Player.getX()+i,Player.getY()+3,Player.getZ(),65);
Level.spawnMob(Player.getX()+3*i,Player.getY()+3,Player.getZ()-i,65);

Level.spawnMob(Player.getX(),Player.getY()+3,Player.getZ()-i,65);
Level.spawnMob(Player.getX()-i,Player.getY()+3,Player.getZ()-3*i,65);
Level.spawnMob(Player.getX()-i,Player.getY()+3,Player.getZ()-i,65);
Level.spawnMob(Player.getX()-i,Player.getY()+3,Player.getZ(),65);
Level.spawnMob(Player.getX()-3*i,Player.getY()+3,Player.getZ()-i,65);

Level.spawnMob(Player.getX(),Player.getY()+3,Player.getZ()+i,65);
Level.spawnMob(Player.getX()-i,Player.getY()+3,Player.getZ()+3*i,65);
Level.spawnMob(Player.getX()-i,Player.getY()+3,Player.getZ()+i,65);
Level.spawnMob(Player.getX()-i,Player.getY()+3,Player.getZ(),65);
Level.spawnMob(Player.getX()-3*i,Player.getY()+3,Player.getZ()+i,65);
}
dialog.dismiss();
}});
layout.addView(bomb);
dialog.setContentView(layout);
dialog.show();
}catch(err){print(err)}
}

function fovzoop()
{
var layout=new android.widget.RelativeLayout(ctx);
try{
var fov = false;
zoop=new android.widget.PopupWindow();
var button=new android.widget.Button(ctx);
button.setText("+");
button.setOnClickListener(new android.view.View.OnClickListener({onClick:function(viewarg){
if(fov == false){fov = true;
ModPE.setFov(24);}
else{fov = false;
ModPE.resetFov();}
}}));
layout.addView(button);
zoop.setContentView(layout);
zoop.setWidth(96);
zoop.setHeight(96);
zoop.showAtLocation(ctx.getWindow().getDecorView(), android.view.Gravity.LEFT | android.view.Gravity.BOTTOM, 0, 384);
}
catch(err){print("Error:"+err);
}}

function openflan()
{
var layout=new android.widget.RelativeLayout(ctx);
try{
shoot=new android.widget.PopupWindow();
var button=new android.widget.Button(ctx);
button.setText("⊙");
button.setOnTouchListener(new android.view.View.OnTouchListener(
{
onTouch :function(v, e)
{
switch (e.getAction())
{
case 0:
shooting=1
break;
case 1:
shooting=0
break;
}
return true;
}
}));
layout.addView(button);
shoot.setContentView(layout);
shoot.setWidth(96);
shoot.setHeight(96);
shoot.showAtLocation(ctx.getWindow().getDecorView(), android.view.Gravity.LEFT | android.view.Gravity.BOTTOM, 0, 288);
}
catch(err){print("Error:"+err);
}}

function rpg()
{
var a=(getYaw()%360)*Math.PI/180
var b=getPitch()*Math.PI/180
var xv,yv,zv
xv=-Math.sin(a)*Math.cos(b)
yv=-Math.sin(b)
zv=Math.cos(a)*Math.cos(b)
var sn=Level.spawnMob(getPlayerX()+xv*2.1,getPlayerY()+yv*2.1,getPlayerZ()+zv*2.1,81)
setVelX(sn,xv*3)
setVelY(sn,yv*3)
setVelZ(sn,zv*3)
}

//关于
function about()
{
try{
var dialog=new android.app.AlertDialog.Builder(ctx);
dialog.setTitle("关于");
dialog.setMessage("空岛小帮手  正式版V"+JsVersion+"\n作者:QingChenW\n更新网址:http://www.mcbbs.net/thread-583823-1-1.html\n讨论群:287307326\n欢迎提交bug和建议\n感谢您的使用");
dialog.setPositiveButton("返回",new android.content.DialogInterface.OnClickListener(){onClick: function(dialog,w){
dialog.dismiss();
}})
dialog.show();
}catch(err){print(err)}
}

//其实我本来想加密来着,但是还是算了QAQ... By QingChenW